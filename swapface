{"cells":[{"cell_type":"markdown","source":["# 一键换脸\n","![GitHub repo size](https://img.shields.io/github/repo-size/k186/roop-colab)\n","\n","\n","请合理使用,切勿伤害他人,适度玩笑;\n","\n","如有问题请联系\n","\n","微信：k1868548k\n","\n","e-mail:k1868548@gmail.com"],"metadata":{"id":"4yHAA_ixlxDH"}},{"cell_type":"markdown","metadata":{"id":"D3L8Lkyj-5gl"},"source":["# 步骤一：安装环境"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"0aHr4Fo-7IRy"},"outputs":[],"source":["!git clone https://github.com/s0md3v/roop.git\n","!git clone https://github.com/k186/roop-colab.git\n","%cd roop\n","!pip install -r requirements.txt"]},{"cell_type":"markdown","metadata":{"id":"jl9zIFZYGWTQ"},"source":["#步骤二：安装模型"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"UQH2exUYGTbK"},"outputs":[],"source":["!wget https://civitai.com/api/download/models/85159 -O inswapper_128.onnx"]},{"cell_type":"markdown","metadata":{"id":"nCKli1C-_EaO"},"source":["#步骤三：换脸"]},{"cell_type":"markdown","source":["下面两个换脸任选一个\n","\n","请严格按照提示 命名文件和文件格式\n","\n","我们的目的是把A的脸换到B身体上面\n"],"metadata":{"id":"jTWojfTojKoR"}},{"cell_type":"markdown","source":["##视频换脸（仅支持MP4格式）\n","\n","***更换视频的脸***\n","\n","把B的视频命名为`target.mp4` 大小限制10MB以内，时间10s左右不要太大\n","\n","把A的图片命名为`source.png` 图片大小1024像素以上最好只给上半身单人照"],"metadata":{"id":"hz_otmqwisgB"}},{"cell_type":"code","execution_count":null,"metadata":{"id":"lDYdfL3L71i1"},"outputs":[],"source":["!python run.py --target /content/roop-colab/target.mp4 --video-quality 18 --source /content/roop-colab/source.png -o /content/roop-colab/换脸后的视频.mp4 --many-faces --keep-frames --execution-provider cuda --frame-processor face_swapper face_enhancer"]},{"cell_type":"markdown","source":["##图片换脸\n","\n","***更换图片的脸***\n","\n","图片大小不要超过5MB\n","\n","把B的图片命名为`target.png` 大小限制10MB以内，时间10s左右不要太大\n","\n","把A的图片命名为`source.png` 图片大小1024像素以上最好只给上半身单人照"],"metadata":{"id":"GArZO9UOjDIx"}},{"cell_type":"code","source":["!python run.py --target /content/roop-colab/target.png --source /content/roop-colab/source.png -o /content/roop-colab/换脸后的图片.png --execution-provider cuda --frame-processor face_swapper face_enhancer"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"vk_1ljsCjFh9","executionInfo":{"status":"ok","timestamp":1689935112654,"user_tz":-480,"elapsed":29187,"user":{"displayName":"易雄（YPanda）","userId":"03786321751940990128"}},"outputId":"316cb11a-2bce-44f8-fa6d-613a138c1320"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Applied providers: ['CUDAExecutionProvider', 'CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}, 'CUDAExecutionProvider': {'device_id': '0', 'gpu_mem_limit': '18446744073709551615', 'gpu_external_alloc': '0', 'gpu_external_free': '0', 'gpu_external_empty_cache': '0', 'cudnn_conv_algo_search': 'EXHAUSTIVE', 'cudnn_conv1d_pad_to_nc1d': '0', 'arena_extend_strategy': 'kNextPowerOfTwo', 'do_copy_in_default_stream': '1', 'enable_cuda_graph': '0', 'cudnn_conv_use_max_workspace': '1', 'tunable_op_enable': '0', 'enable_skip_layer_norm_strict_mode': '0', 'tunable_op_tuning_enable': '0'}}\n","find model: /root/.insightface/models/buffalo_l/1k3d68.onnx landmark_3d_68 ['None', 3, 192, 192] 0.0 1.0\n","Applied providers: ['CUDAExecutionProvider', 'CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}, 'CUDAExecutionProvider': {'device_id': '0', 'gpu_mem_limit': '18446744073709551615', 'gpu_external_alloc': '0', 'gpu_external_free': '0', 'gpu_external_empty_cache': '0', 'cudnn_conv_algo_search': 'EXHAUSTIVE', 'cudnn_conv1d_pad_to_nc1d': '0', 'arena_extend_strategy': 'kNextPowerOfTwo', 'do_copy_in_default_stream': '1', 'enable_cuda_graph': '0', 'cudnn_conv_use_max_workspace': '1', 'tunable_op_enable': '0', 'enable_skip_layer_norm_strict_mode': '0', 'tunable_op_tuning_enable': '0'}}\n","find model: /root/.insightface/models/buffalo_l/2d106det.onnx landmark_2d_106 ['None', 3, 192, 192] 0.0 1.0\n","Applied providers: ['CUDAExecutionProvider', 'CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}, 'CUDAExecutionProvider': {'device_id': '0', 'gpu_mem_limit': '18446744073709551615', 'gpu_external_alloc': '0', 'gpu_external_free': '0', 'gpu_external_empty_cache': '0', 'cudnn_conv_algo_search': 'EXHAUSTIVE', 'cudnn_conv1d_pad_to_nc1d': '0', 'arena_extend_strategy': 'kNextPowerOfTwo', 'do_copy_in_default_stream': '1', 'enable_cuda_graph': '0', 'cudnn_conv_use_max_workspace': '1', 'tunable_op_enable': '0', 'enable_skip_layer_norm_strict_mode': '0', 'tunable_op_tuning_enable': '0'}}\n","find model: /root/.insightface/models/buffalo_l/det_10g.onnx detection [1, 3, '?', '?'] 127.5 128.0\n","Applied providers: ['CUDAExecutionProvider', 'CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}, 'CUDAExecutionProvider': {'device_id': '0', 'gpu_mem_limit': '18446744073709551615', 'gpu_external_alloc': '0', 'gpu_external_free': '0', 'gpu_external_empty_cache': '0', 'cudnn_conv_algo_search': 'EXHAUSTIVE', 'cudnn_conv1d_pad_to_nc1d': '0', 'arena_extend_strategy': 'kNextPowerOfTwo', 'do_copy_in_default_stream': '1', 'enable_cuda_graph': '0', 'cudnn_conv_use_max_workspace': '1', 'tunable_op_enable': '0', 'enable_skip_layer_norm_strict_mode': '0', 'tunable_op_tuning_enable': '0'}}\n","find model: /root/.insightface/models/buffalo_l/genderage.onnx genderage ['None', 3, 96, 96] 0.0 1.0\n","Applied providers: ['CUDAExecutionProvider', 'CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}, 'CUDAExecutionProvider': {'device_id': '0', 'gpu_mem_limit': '18446744073709551615', 'gpu_external_alloc': '0', 'gpu_external_free': '0', 'gpu_external_empty_cache': '0', 'cudnn_conv_algo_search': 'EXHAUSTIVE', 'cudnn_conv1d_pad_to_nc1d': '0', 'arena_extend_strategy': 'kNextPowerOfTwo', 'do_copy_in_default_stream': '1', 'enable_cuda_graph': '0', 'cudnn_conv_use_max_workspace': '1', 'tunable_op_enable': '0', 'enable_skip_layer_norm_strict_mode': '0', 'tunable_op_tuning_enable': '0'}}\n","find model: /root/.insightface/models/buffalo_l/w600k_r50.onnx recognition ['None', 3, 112, 112] 127.5 127.5\n","set det-size: (640, 640)\n","[ROOP.FACE-SWAPPER] Progressing...\n","Applied providers: ['CUDAExecutionProvider', 'CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}, 'CUDAExecutionProvider': {'device_id': '0', 'gpu_mem_limit': '18446744073709551615', 'gpu_external_alloc': '0', 'gpu_external_free': '0', 'gpu_external_empty_cache': '0', 'cudnn_conv_algo_search': 'EXHAUSTIVE', 'cudnn_conv1d_pad_to_nc1d': '0', 'arena_extend_strategy': 'kNextPowerOfTwo', 'do_copy_in_default_stream': '1', 'enable_cuda_graph': '0', 'cudnn_conv_use_max_workspace': '1', 'tunable_op_enable': '0', 'enable_skip_layer_norm_strict_mode': '0', 'tunable_op_tuning_enable': '0'}}\n","inswapper-shape: [1, 3, 128, 128]\n","[ROOP.FACE-ENHANCER] Progressing...\n","[ROOP.CORE] Processing to image succeed!\n"]}]}],"metadata":{"accelerator":"GPU","colab":{"provenance":[{"file_id":"1NG9AoH3QDtC7h97z1Yodmn_CiiGh8Y1T","timestamp":1689927475787}]},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}